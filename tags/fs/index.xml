<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Fs on cheon's blog</title><link>https://number317.github.io/blog/tags/fs/</link><description>Recent content in Fs on cheon's blog</description><generator>Hugo</generator><language>en</language><lastBuildDate>Fri, 14 Jun 2019 01:21:26 +0800</lastBuildDate><atom:link href="https://number317.github.io/blog/tags/fs/index.xml" rel="self" type="application/rss+xml"/><item><title>Glusterfs Deploy</title><link>https://number317.github.io/blog/struct/glusterfs_deploy/</link><pubDate>Tue, 09 Jan 2018 10:09:35 +0800</pubDate><guid>https://number317.github.io/blog/struct/glusterfs_deploy/</guid><description>&lt;h1 id="glusterfs-centos-部署">glusterfs centos 部署&lt;/h1>
&lt;p>GlusterFS是一个开源的分布式文件系统，这里部署它主要为了解决文件存储的单点问题。&lt;/p>
&lt;h2 id="虚拟机配置">虚拟机配置&lt;/h2>
&lt;p>此处采用vagrant部署centos的虚拟机三台，box可以采用bento/centos7.2，配置文件如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ruby" data-lang="ruby">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-weight:bold;font-style:italic">Vagrant&lt;/span>.configure(&lt;span style="color:#666;font-style:italic">&amp;#34;2&amp;#34;&lt;/span>) &lt;span style="font-weight:bold">do&lt;/span> |config|
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (1..3).each &lt;span style="font-weight:bold">do&lt;/span> |i|
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.vm.define &lt;span style="color:#666;font-style:italic">&amp;#34;gluster-node&lt;/span>&lt;span style="color:#666;font-style:italic">#{&lt;/span>i&lt;span style="color:#666;font-style:italic">}&lt;/span>&lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span> &lt;span style="font-weight:bold">do&lt;/span> |node|
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> file_to_disk = &lt;span style="color:#666;font-style:italic">&amp;#34;tmp/gluster_node&lt;/span>&lt;span style="color:#666;font-style:italic">#{&lt;/span>i&lt;span style="color:#666;font-style:italic">}&lt;/span>&lt;span style="color:#666;font-style:italic">_disk.vdi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node.vm.box = &lt;span style="color:#666;font-style:italic">&amp;#34;centos-7.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node.vm.hostname = &lt;span style="color:#666;font-style:italic">&amp;#34;gluster-node&lt;/span>&lt;span style="color:#666;font-style:italic">#{&lt;/span>i&lt;span style="color:#666;font-style:italic">}&lt;/span>&lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> n = 100 +i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node.vm.network &lt;span style="color:#666;font-style:italic">&amp;#34;private_network&amp;#34;&lt;/span>, &lt;span style="color:#666;font-style:italic">ip&lt;/span>: &lt;span style="color:#666;font-style:italic">&amp;#34;192.168.12.&lt;/span>&lt;span style="color:#666;font-style:italic">#{&lt;/span>n&lt;span style="color:#666;font-style:italic">}&lt;/span>&lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node.vm.provider &lt;span style="color:#666;font-style:italic">&amp;#34;virtualbox&amp;#34;&lt;/span> &lt;span style="font-weight:bold">do&lt;/span> |vb|
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold">unless&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">File&lt;/span>.exist?(file_to_disk)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vb.customize [&lt;span style="color:#666;font-style:italic">&amp;#39;createhd&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;--filename&amp;#39;&lt;/span>, file_to_disk, &lt;span style="color:#666;font-style:italic">&amp;#39;--size&amp;#39;&lt;/span>, 10 * 1024]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vb.customize [&lt;span style="color:#666;font-style:italic">&amp;#39;storageattach&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">:id&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;--storagectl&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;SATA Controller&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;--port&amp;#39;&lt;/span>, 1, &lt;span style="color:#666;font-style:italic">&amp;#39;--device&amp;#39;&lt;/span>, 0, &lt;span style="color:#666;font-style:italic">&amp;#39;--type&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;hdd&amp;#39;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#39;--medium&amp;#39;&lt;/span>, file_to_disk]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vb.name = &lt;span style="color:#666;font-style:italic">&amp;#34;gluster-node&lt;/span>&lt;span style="color:#666;font-style:italic">#{&lt;/span>i&lt;span style="color:#666;font-style:italic">}&lt;/span>&lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vb.cpus = 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vb.memory = 1024
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>该配置文件根据官方&lt;a href="http://docs.gluster.org/en/latest/Quick-Start-Guide/Quickstart/">quick start&lt;/a>文档，为虚拟机配置了第二磁盘，用于GlusterFS存储，大小为10G。&lt;/p>
&lt;h2 id="格式化并挂载分区">格式化并挂载分区&lt;/h2>
&lt;p>以下步骤需要在三台虚拟机上都执行一遍，为了方便操作，切换到root用户：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>为磁盘创建分区&lt;/p>
&lt;p>通过&lt;code>vagrant ssh&lt;/code>命令进入到任意一个节点，执行&lt;code>lsblk&lt;/code>命令应该能查看到类似以下输出：&lt;/p></description></item></channel></rss>