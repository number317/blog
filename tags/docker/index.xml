<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on cheon's blog</title><link>https://number317.github.io/blog/tags/docker/</link><description>Recent content in Docker on cheon's blog</description><generator>Hugo</generator><language>en</language><lastBuildDate>Wed, 18 Sep 2019 15:59:10 +0800</lastBuildDate><atom:link href="https://number317.github.io/blog/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Dockerfile Tips</title><link>https://number317.github.io/blog/shell/dockerfile_tips/</link><pubDate>Thu, 13 Jun 2019 13:51:36 +0800</pubDate><guid>https://number317.github.io/blog/shell/dockerfile_tips/</guid><description>&lt;h1 id="dockerfile-编写建议">Dockerfile 编写建议&lt;/h1>
&lt;p>日常编写&lt;code>Dockerfile&lt;/code>的过程中总结的一些经验:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>基础镜像尽量选择&lt;code>alpine&lt;/code>版本，减小镜像体积，如果需要glibc，在&lt;code>Dockerfile&lt;/code>中添加以下指令&lt;/p>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-b6941b1daea7f29d72b9dd1114a412b5">RUN apk --no-cache add ca-certificates wget &amp;amp;&amp;amp; \
 wget -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub &amp;amp;&amp;amp; \
 wget https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.29-r0/glibc-2.29-r0.apk &amp;amp;&amp;amp; \
 apk --no-cache add glibc-2.29-r0.apk&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-b6941b1daea7f29d72b9dd1114a412b5', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;p>关于在&lt;code>alpine&lt;/code>镜像中安装&lt;code>glibc&lt;/code>，详情可以参考&lt;a href="https://github.com/sgerrand/alpine-pkg-glibc" target="_blank" rel="noopener noreferrer" >
 github
&lt;/a>
介绍&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在&lt;code>Dockerfile&lt;/code>里需要安装软件的尽量使用国内的源，加快ci构建，常见的操作如下：&lt;/p>
&lt;ul>
&lt;li>alpine:&lt;/li>
&lt;/ul>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-f2358beb7617f0ddd9dc008afa8fc634">RUN sed -i &amp;#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&amp;#39; /etc/apk/repositories&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-f2358beb7617f0ddd9dc008afa8fc634', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;ul>
&lt;li>debian:&lt;/li>
&lt;/ul>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-cd701bdb53aff8650da45b46b21835ce">curl -L &amp;#34;https://mirrors.ustc.edu.cn/repogen/conf/debian-https-4-buster&amp;#34; -o /etc/apt/sources.list&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-cd701bdb53aff8650da45b46b21835ce', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;ul>
&lt;li>centos:&lt;/li>
&lt;/ul>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-161fb425cfe298c0d027abe73d154afa">RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-161fb425cfe298c0d027abe73d154afa', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;ul>
&lt;li>node:&lt;/li>
&lt;/ul>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-c8fdd63da17030e3a61fad7b2768a8f4">RUN npm install --registry=https://registry.npm.taobao.org \
 &amp;amp;&amp;amp; npm config set phantomjs_cdnurl https://npm.taobao.org/dist/phantomjs \
 &amp;amp;&amp;amp; npm config set chromedriver_cdnurl http://cdn.npm.taobao.org/dist/chromedriver \
 &amp;amp;&amp;amp; npm config set sass_binary_site http://npm.taobao.org/mirrors/node-sass&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-c8fdd63da17030e3a61fad7b2768a8f4', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;/li>
&lt;li>
&lt;p>构建镜像时如果需要代理，可以配置以下参数：&lt;/p></description></item><item><title>Docker Graph Migrate</title><link>https://number317.github.io/blog/struct/docker_graph_migrate/</link><pubDate>Tue, 14 May 2019 19:33:12 +0800</pubDate><guid>https://number317.github.io/blog/struct/docker_graph_migrate/</guid><description>&lt;h1 id="docker-目录迁移">docker 目录迁移&lt;/h1>
&lt;p>服务器根目录磁盘空间比较小，只有50G，在使用一段时间后镜像增多，磁盘不够用，准备将 docker 的目录挂载到新加的磁盘。挂载硬盘后如下：&lt;/p>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-ce7aeef8519f77a3c574ce87b688ffd0">NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sr0 11:0 1 3.7M 0 rom
vda 253:0 0 50G 0 disk
└─vda1 253:1 0 50G 0 part /
vdb 253:16 0 200G 0 disk&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-ce7aeef8519f77a3c574ce87b688ffd0', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;h2 id="创建-lvm">创建 lvm&lt;/h2>
&lt;p>为了以后方便扩容，准备使用 lvm。首先创建 pv：&lt;/p>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-cf251ec788f2e49006c9f1e14662fcec">pvcreate /dev/vdb&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-cf251ec788f2e49006c9f1e14662fcec', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;p>创建 vg，命名为 docker：&lt;/p>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-89b87f5e74e4ec2ab94e68ad3ce2480e">vgcreate docker /dev/vdb&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-89b87f5e74e4ec2ab94e68ad3ce2480e', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;p>创建 lv，命名为 registry：&lt;/p>


&lt;div class="code-block code-block-container-indented">
 &lt;pre>&lt;code id="code-92db4c007d2c9588fc09f674b646c2f7">lvcreate -l &amp;#43;100%Free docker --name registry&lt;/code>&lt;/pre>
 &lt;button class="copy-code-button" onclick="copyCode('code-92db4c007d2c9588fc09f674b646c2f7', this)" title="copy">
 &lt;i class="fa fa-copy">&lt;/i>
 &lt;/button>
&lt;/div>

&lt;p>将 lv 格式化为 xfs 文件系统：&lt;/p></description></item></channel></rss>