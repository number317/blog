<!doctype html><html><head><meta charset=utf-8><meta name=description content="Aloha! Welcome to cheon's blog."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=76x76 href=https://number317.github.io/blog/img/apple-touch-icon.png><link rel=icon href=https://number317.github.io/blog/img/pen.svg><link rel=stylesheet href=https://number317.github.io/blog/css/global.css><link rel=stylesheet href=https://number317.github.io/blog/css/nav.css><link rel=stylesheet href=https://number317.github.io/blog/css/header.css><link rel=stylesheet href=https://number317.github.io/blog/css/index.css><link rel=stylesheet href=https://number317.github.io/blog/css/list.css><link rel=stylesheet href=https://number317.github.io/blog/css/single.css><link rel=stylesheet href=https://number317.github.io/blog/css/footer.css><link href="https://fonts.googleapis.com/css?family=Fira+Mono|Noto+Sans+SC|Old+Standard+TT&display=swap" rel=stylesheet><link href=https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><script src=https://number317.github.io/blog/js/single.js></script><title>cheon's blog</title></head><body><section id=header><ul id=menus><li class=menu><a href=https://number317.github.io><span>Home</span></a></li><li class=menu><a href=https://number317.github.io/blog/categories><span>Categories</span></a></li><li class=menu><a href=https://number317.github.io/blog/tags><span>Tags</span></a></li><li class=menu><a href=https://github.com/number317><span>Projects</span></a></li></ul><h1 id=title><a href=https://number317.github.io/blog/>cheon's blog</a></h1></section><ul id=nav><li>»
<a href=https://number317.github.io/blog/>cheon's blog</a></li><li>»
<a href=https://number317.github.io/blog/solved/>solved</a></li><li class=active>»
<a href=https://number317.github.io/blog/solved/openshift_restart_node/>Openshift Restart Node</a></li></ul><div id=content><main id=main><h1>Openshift Restart Node</h1><time>Last updated Fri Jun 14, 2019</time><div><aside><h2>Table of Content</h1><nav id=TableOfContents><ul><li><a href=#删除-node-调度>删除 node 调度</a></li></ul></nav></aside><article id=content><h1 id=openshift-节点无法连接集群>openshift 节点无法连接集群</h1><p>在openshift master 节点上执行<code>oc get node</code>:</p><div class="code-block code-block-container-indented"><pre><code id=code-8f2a3c624b7987d563537f97536bdddc>$ oc get node
NAME      STATUS                        AGE
node1     NotReady,SchedulingDisabled   301d
master1   Ready                         308d
master2   Ready                         308d
master3   Ready                         308d
master4   Ready                         308d
master5   Ready                         31d</code></pre><button class=copy-code-button onclick='copyCode("code-8f2a3c624b7987d563537f97536bdddc",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>其中的node1状态为<code>NotReady,SchedulingDisabled</code>，改节点没有准备好，并且是无法调度的，其中无法调度是手动设置的：</p><div class="code-block code-block-container-indented"><pre><code id=code-274c61e7c4a8887c3e5422ffbfbd523a>$ openshift admin manage-node node1 --schedulable=false</code></pre><button class=copy-code-button onclick='copyCode("code-274c61e7c4a8887c3e5422ffbfbd523a",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>重启<code>origin-node</code>服务，让节点重新连接集群：</p><div class="code-block code-block-container-indented"><pre><code id=code-9d846fb0e63c73a2503e07223620dca6>$ systemctl restart origin-node</code></pre><button class=copy-code-button onclick='copyCode("code-9d846fb0e63c73a2503e07223620dca6",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>重新查看节点状态：</p><div class="code-block code-block-container-indented"><pre><code id=code-9d3c9e21558272cdc0a93324f5518942>$ oc get node
NAME      STATUS                        AGE
node1     Ready,SchedulingDisabled      301d
master1   Ready                         308d
master2   Ready                         308d
master3   Ready                         308d
master4   Ready                         308d
master5   Ready                         31d</code></pre><button class=copy-code-button onclick='copyCode("code-9d3c9e21558272cdc0a93324f5518942",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>节点已经 ready，再将其设置为可调度的：</p><div class="code-block code-block-container-indented"><pre><code id=code-0d7b6f184f2ed61df52981b21d88a065>$ openshift admin manage-node node1 --schedulable=true</code></pre><button class=copy-code-button onclick='copyCode("code-0d7b6f184f2ed61df52981b21d88a065",this)' title=copy>
<i class="fa fa-copy"></i></button></div><h1 id=疏散-pods>疏散 Pods</h1><p>标记节点不可调度:</p><div class="code-block code-block-container-indented"><pre><code id=code-c70011f2a06bc1af5f9169f6919be1e7>$ openshift admin manage-node &lt;node&gt; --schedulable=false</code></pre><button class=copy-code-button onclick='copyCode("code-c70011f2a06bc1af5f9169f6919be1e7",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>列出节点上所有的Pods,请再次确认:</p><div class="code-block code-block-container-indented"><pre><code id=code-1179a29701ed4bb3aeb983e7dd578f31>$ oadm manage-node &lt;node1&gt; &lt;node2&gt; --evacuate --dry-run [--pod-selector=&lt;pod_selector&gt;]</code></pre><button class=copy-code-button onclick='copyCode("code-1179a29701ed4bb3aeb983e7dd578f31",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>疏散 Pods:</p><div class="code-block code-block-container-indented"><pre><code id=code-6b1c1af97bf5441e7d3286ead489cf43>$ oadm drain &lt;node1&gt; &lt;node2&gt;</code></pre><button class=copy-code-button onclick='copyCode("code-6b1c1af97bf5441e7d3286ead489cf43",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>如果无法疏散，可以强制疏散:</p><div class="code-block code-block-container-indented"><pre><code id=code-2c8a2729fd6184b178729bbecf2502e3>$ oadm drain &lt;node1&gt; &lt;node2&gt; --force</code></pre><button class=copy-code-button onclick='copyCode("code-2c8a2729fd6184b178729bbecf2502e3",this)' title=copy>
<i class="fa fa-copy"></i></button></div><h2 id=删除-node-调度>删除 node 调度</h2><div class="code-block code-block-container-indented"><pre><code id=code-68b5272a2e22c3e4862aa62d71264ef9>$ oc delete node &lt;node&gt;</code></pre><button class=copy-code-button onclick='copyCode("code-68b5272a2e22c3e4862aa62d71264ef9",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>进行确认:</p><div class="code-block code-block-container-indented"><pre><code id=code-0048f30b75967f493e0c2913e0b87d75>$ oc get nodes</code></pre><button class=copy-code-button onclick='copyCode("code-0048f30b75967f493e0c2913e0b87d75",this)' title=copy>
<i class="fa fa-copy"></i></button></div></article></div></main><div><h4 id=signature>Thu Mar 8, 2018
cheon</h4><ul class=tags><li><a href=https://number317.github.io/blog/tags/openshift>openshift</a></li></ul><ul class=related><li><a class=previous href=https://number317.github.io/blog/solved/tomcat_deploy_error/>Tomcat Deploy Error</a></li><li><a class=next href=https://number317.github.io/blog/solved/firefox_open_markdown/>Firefox Open Markdown</a></li></ul></div></div><section id=footer><div id=author><h2>About Author</h2><hr><img src=https://number317.github.io/images/author.jpg></img><p>Life is dance we all have to do.</p></div><ul id=link><li><a href=https://github.com/number317/aloha.git target=_blank><i class="fa fa-github" alt=github></i></a></li><li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target=_blank><i class="fa fa-envelope" alt=email></i></a></li><li id=wechat><i class="fa fa-wechat"></i></li><img class=qrcode src=https://number317.github.io/images/wechat.jpg></ul></section></body></html>