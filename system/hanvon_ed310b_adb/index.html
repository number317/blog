<!doctype html><html><head><meta charset=utf-8><meta name=description content="Aloha! Welcome to cheon's blog."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=76x76 href=https://number317.github.io/blog/img/apple-touch-icon.png><link rel=icon href=https://number317.github.io/blog/img/pen.svg><link rel=stylesheet href=https://number317.github.io/blog/css/global.css><link rel=stylesheet href=https://number317.github.io/blog/css/nav.css><link rel=stylesheet href=https://number317.github.io/blog/css/header.css><link rel=stylesheet href=https://number317.github.io/blog/css/index.css><link rel=stylesheet href=https://number317.github.io/blog/css/list.css><link rel=stylesheet href=https://number317.github.io/blog/css/single.css><link rel=stylesheet href=https://number317.github.io/blog/css/footer.css><link href="https://fonts.font.im/css?family=Fira+Mono|Noto+Sans|Old+Standard+TT" rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://number317.github.io/blog/js/single.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.js async></script><title>cheon's blog</title></head><body><section id=header><ul id=menus><li class=menu><a href=https://number317.github.io><span>Home</span></a></li><li class=menu><a href=https://number317.github.io/blog/categories><span>Categories</span></a></li><li class=menu><a href=https://number317.github.io/blog/tags><span>Tags</span></a></li><li class=menu><a href=https://github.com/number317><span>Projects</span></a></li></ul><h1 id=title><a href=https://number317.github.io/blog/>cheon's blog</a></h1></section><ul id=nav><li>»
<a href=https://number317.github.io/blog/>cheon's blog</a></li><li>»
<a href=https://number317.github.io/blog/system/>system</a></li><li class=active>»
<a href=https://number317.github.io/blog/system/hanvon_ed310b_adb/>Hanvon Ed310B Adb</a></li></ul><div id=content><main id=main><h1>Hanvon Ed310B Adb</h1><time>Last updated Wed Sep 3, 2025</time><div><aside><h2>Table of Content</h1><nav id=TableOfContents><ul><li><a href=#问题初现>问题初现</a></li><li><a href=#尝试解决>尝试解决</a></li><li><a href=#根因分析>根因分析</a></li><li><a href=#解决方案>解决方案</a></li><li><a href=#总结>总结</a></li></ul></nav></aside><article id=content><h1 id=hanvon-ed310b-adb>Hanvon Ed310B Adb</h1><h2 id=问题初现>问题初现</h2><p>最近入手了一个 13.3 寸的墨水屏设备，汉王的 ED310 PLUS，好多年前的电子产品了，买这一款主要是因为便宜，性价比高，拿来看看 pdf 完全够用。我拿到安卓设备的第一件事情就是打开设备的 adb。</p><p>设备没有 Android 原生设置的入口，但是可以安装软件。我电脑上下载了 <code>Termux</code> 后通过 USB 传输至设备，在设备上安装后打开执行 <code>am start com.android.settings</code> 打开了设置。</p><p>在设置中点击 <code>系统 -> 关于平板电脑</code> 看到 <code>Android 版本</code>，连点 7 次打开开发者模式。然后在开发者模式中打开 <code>USB 调试模式</code>。</p><p>至此我以为很轻松的就完成了，结果连接上电脑后，电脑显示 <code>unauthorized</code>，并且设备也没有弹出 RSA 授权弹窗……相当于 <code>adb</code> 完全不可用。</p><h2 id=尝试解决>尝试解决</h2><p>连接入电脑设备无弹窗，最先尝试的是换一条数据线，发现不管用，看来不是数据线的问题。</p><p>换了另外一台电脑，一样的 <code>unauthorized</code>。</p><p>撤销USB调试授权，经过尝试后重启设备发现也是无用，看来也不是这个问题。</p><p>经过一系列尝试都无法解决这个问题，那么问答大概率出在系统上了，也许是系统阉割了这部分功能或者功能受到了限制。要想解决这个问题还得找到问题的原因。</p><h2 id=根因分析>根因分析</h2><p>搜索资料发现 Android 设备的 RSA 弹窗逻辑在 services 服务中，我在 <code>Termux</code> 中安装了 <code>ssh</code> 服务方便我在电脑上远程探索设备。</p><p>不知道设备上的 services 应用放在哪里，但是肯定在 <code>/system</code> 目录下，我们搜索一下：</p><details><summary>查找 services</summary><div class="code-block code-block-container-indented"><pre><code id=code-970f8054d9437aa5671166d910b67a45>/system $ find . -name &#34;service*&#34;
find: ‘./lost&#43;found’: Permission denied
./bin/service
./bin/servicemanager
./etc/init/servicemanager.rc
./framework/oat/arm/services.art
./framework/oat/arm/services.odex
./framework/oat/arm/services.vdex
./framework/services.jar
./framework/services.jar.prof</code></pre><button class=copy-code-button onclick='copyCode("code-970f8054d9437aa5671166d910b67a45",this)' title=copy>
<i class="fa fa-copy"></i></button></div></details><p>看起来操作系统使用了 <code>AOT（Ahead-of-Time）</code> 编译（即直接使用 odex 文件运行，而不是原始的 apk 和 dex），其中 <code>odex</code> 文件是优化后的 DEX 文件，通常用于加速启动速度。<code>vdex</code> 是验证后的 DEX 文件，包含未修改的 DEX 数据，用于 <code>ART（Android Runtime）</code> 运行时加载并优化。</p><p>根据文件名判断应该就是 <code>/system/framework/oat/arm/services.vdex</code> 文件了，从设备上复制到电脑上，使用 <code>vdexExtractor --ignore-crc-error -i services.vdex</code> 将 <code>vdex</code> 文件转换为 <code>dex</code> 文件。再用 <code>jadx-gui services_class.dex</code> 反编译 dex 文件。在 jadx-gui 中直接搜索 <code>UsbDebuggingManager</code> 可以找到 <code>com.android.server.usb.UsbDebuggingManager</code> 文件。</p><p>可以看到如下逻辑：</p><p><img src=https://number317.github.io/blog/system/images/hanvon_ed310b_adb_img1.png alt=BUILD_TYPE>
<img src=https://number317.github.io/blog/system/images/hanvon_ed310b_adb_img2.png alt=ListenToSocket>
<img src=https://number317.github.io/blog/system/images/hanvon_ed310b_adb_img3.png alt=UsbHandler></p><p>大致逻辑就是 <code>ro.build.type</code> 是 <code>user</code> 时系统会发送 <code>DENY</code> 信号，估计就是这个逻辑导致了授权弹窗不出现，直接拒绝了，而这个设备的 <code>/system/build.prop</code> 确实就是 <code>user</code>。</p><h2 id=解决方案>解决方案</h2><p>现在知道了问题所在，那么解决方案有两种思路，一是修改 <code>ro.build.type</code> 的值，我在我的 inkpadx 上测试了这一点，结果直接导致设备开机后无法正常进入系统。幸好虽然卡住但是 adb 还能使用，修改回原值后重启恢复了，看来这个方法行不通。并且修改 <code>/system/build.prop</code> 也是需要 root 权限的。</p><p>另一个方法是我们直接跳过 RSA 授权，通过直接写入 ADB 公钥文件来解决问题。但是不确定是不是管用，只能测试下（因为不确定代码逻辑发送 DENY 信号是拒绝 RSA 弹窗还是直接拒绝 adb 连接）。但是这个操作也需要 root 权限……</p><p>所以现在的问题就变成了如何 root 设备了，并且还是在 adb 不可用的情况下……</p><p>刚刚查看 build.prop 就发现了这个设备 OTA 更新包大概率也是用的测试密钥签名的，参考我之前的 <a href=https://number317.github.io/blog/system/moaan_inkpadx_root/ target=_blank rel="noopener noreferrer">Moaan InkpadX Root
</a>root 方法，需要重启至恢复模式，但是现在用不了 <code>adb reboot recovery</code> 我们要解决的就是让 adb 可用，现在死锁了……</p><p>幸好经过我对设备的探索，发现开发者模式下有一个重启进入恢复模式的菜单，nice！</p><p>我重启后确实进入了恢复模式，结果发现触摸屏失效了……估计在这个模式下没有加载触摸屏的驱动。页面上提示用音量键切换菜单，但是这设备哪来的音量键，我通过外接鼠标键盘、尝试了设备上的各种组合键（设备总共两个按键，试了各种组合、长按）发现也无法切换菜单，只能说这个系统完善度不够啊，那这个方法现在也走不通了。</p><p>期间我又尝试了各种方法，甚至尝试了 <code>metaexploit</code> 工具来试试有没有漏洞能提权的，结果都没有成功。最后只能去研究系统自带的 OTA 更新功能，这个功能是汉王设备都有的功能，但是由于不知道他需要的 OTA 更新包的格式，所以一直没有去尝试，但现在也没有别的方法了。</p><p>首先在官网看看有没有这款设备的更新包，结果发现没有……这得是多小众的产品啊。只能找一个类似的墨水屏设备的更新包来分析了。我下载下来解压后发现有一个 <code>version</code> 文件是陌生的，别的好像都是标准的 OTA 升级包内容。我习惯性的 <code>cat version</code> 查看了一下（坏就坏在这里了）：</p><div class="code-block code-block-container-indented"><pre><code id=code-6a66fa729013ec10db35bb778caaf44d>~/Downloads/update/ cat version
HWV1.10SYV1.78PHV1.00FHV1.00SYV1.78.42</code></pre><button class=copy-code-button onclick='copyCode("code-6a66fa729013ec10db35bb778caaf44d",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>看起来就是一些版本信息，根据我的设备提供的版本信息大致推断下：</p><ul><li><p>HWV1.10：HWV可能表示“HardWareVersion”，即硬件版本。数字 1.10 表示当前设备的硬件版本是 1.10。</p></li><li><p>SYV1.78：SYV可能表示“SystemVersion”，即系统版本（或主版本号）。数字 1.78 表示升级包支持的系统版本是 1.78。</p></li><li><p>PHV1.00：PHV可能是“PackageHardWareVersion”，即升级包针对硬件的最低版本要求。数字 1.00 表示该OTA升级包的硬件版本兼容要求为 1.00 或更高。</p></li><li><p>FHV1.00：FHV可能是“FirmwareHardWareVersion”，即固件与硬件匹配的版本。数字 1.00 表示升级包的最低固件硬件版本要求为 1.00 或更高。</p></li><li><p>SYV1.78.42：这里 SYV 再次出现，但似乎是表示升级后的完整系统版本号。数字 1.78.42 表示升级后的系统应该是 1.78.42。</p></li></ul><p>根据设备提供的版本信息我很快就构造出来了一个 version 文件，版本信息是 <code>HWV10.00SYV1.00PHV1.00FHV1.00SYV1.00.09</code>，构建好一个提取 boot 镜像的升级包，点击升级。</p><p>升级界面出现了，设备显示了升级的动画，感觉要成功了。等了一会儿，升级出错了……</p><p>我就知道没这么简单，难道是版本写错了。我又尝试了其他版本号，一样的报错。</p><p>没办法了，看不到 adb logcat 日志，也不知道发生了什么，只能看下升级的代码逻辑了。找到了设备上升级相关的代码，依旧用 apktool 反编译出来。发现读取 version 的代码竟然是从指定字节开始读取的，难道这个 version 不是纯文本文件吗？我又用 <code>file --mime-type version</code> 查看了一下，显示是 <code>application/octet-stream</code> 确实不是纯文本，大意了。</p><p>使用 vim 用 xxd 模式查看 version 文件，发现文件中连续出现大量 0x00 字节。这些字节可能是用于占位或填充，目的是形成固定的内存布局或对齐。这种固定结构对解析器来说更容易处理。那就好办了，复制了一个 version 文件，改了其中的版本号，并且对齐长度。重新构建一个提取 boot 镜像的升级包。</p><p>这次总算升级成功了，也顺利提取出了 boot 镜像。在设备安装好 Magisk 后给 boot 镜像打补丁，再构建一个升级包，升级后系统 root 成功。</p><p>总算 root 成功了，将 <code>~/.adb/adbkey.pub</code> 复制到设备上，测试下手动推送公钥是否可行：</p><div class="code-block code-block-container-indented"><pre><code id=code-28426cdc214e78549e75773e9863326d>su
cp /sdcard/adbkey.pub /data/misc/adb/adb_keys
chmod 640 /data/misc/adb/adb_keys
chown system:shell /data/misc/adb/adb_keys</code></pre><button class=copy-code-button onclick='copyCode("code-28426cdc214e78549e75773e9863326d",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>然后重启设备，连接上电脑，adb 命令果然已经授权成功了，太艰难了。</p><h2 id=总结>总结</h2><p>这次启用 adb 和 root 设备遇到了许多困难，一个困难解决了，又出现了另一个问题，但这正是折腾的乐趣所在。</p><p>这个设备 adb 启用后测试了 scrcpy 结果发现电脑上无画面出现，搜索了 issue 应该是硬件不支持。不能用就算了，起码看看 pdf 还是挺好用的。</p></article></div></main><div><h4 id=signature>Sat Jul 12, 2025
cheon</h4><ul class=tags><li><a href=https://number317.github.io/blog/tags/android>android</a></li><li><a href=https://number317.github.io/blog/tags/eink>eink</a></li><li><a href=https://number317.github.io/blog/tags/root>root</a></li></ul><ul class=related><li><a class=previous href=https://number317.github.io/blog/system/moaan_inkpadx_root/>Moaan InkpadX Root</a></li></ul></div></div><section id=footer><div id=author><h2>About Author</h2><hr><img src=https://number317.github.io/images/author.jpg></img><p>Life is dance we all have to do.</p></div><ul id=link><li><a href=https://github.com/number317/aloha.git target=_blank><i class="fa fa-github" alt=github></i></a></li><li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target=_blank><i class="fa fa-envelope" alt=email></i></a></li><li id=wechat><i class="fa fa-wechat"></i></li><img class=qrcode src=https://number317.github.io/images/wechat.jpg></ul></section></body></html>