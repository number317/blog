<!doctype html><html><head><meta charset=utf-8><meta name=description content="Aloha! Welcome to cheon's blog."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=76x76 href=https://number317.github.io/blog/img/apple-touch-icon.png><link rel=icon href=https://number317.github.io/blog/img/pen.svg><link rel=stylesheet href=https://number317.github.io/blog/css/global.css><link rel=stylesheet href=https://number317.github.io/blog/css/nav.css><link rel=stylesheet href=https://number317.github.io/blog/css/header.css><link rel=stylesheet href=https://number317.github.io/blog/css/index.css><link rel=stylesheet href=https://number317.github.io/blog/css/list.css><link rel=stylesheet href=https://number317.github.io/blog/css/single.css><link rel=stylesheet href=https://number317.github.io/blog/css/footer.css><link href="https://fonts.font.im/css?family=Fira+Mono|Noto+Sans|Old+Standard+TT" rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://number317.github.io/blog/js/single.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.js async></script><title>cheon's blog</title></head><body><section id=header><ul id=menus><li class=menu><a href=https://number317.github.io><span>Home</span></a></li><li class=menu><a href=https://number317.github.io/blog/categories><span>Categories</span></a></li><li class=menu><a href=https://number317.github.io/blog/tags><span>Tags</span></a></li><li class=menu><a href=https://github.com/number317><span>Projects</span></a></li></ul><h1 id=title><a href=https://number317.github.io/blog/>cheon's blog</a></h1></section><ul id=nav><li>»
<a href=https://number317.github.io/blog/>cheon's blog</a></li><li>»
<a href=https://number317.github.io/blog/shell/>shell</a></li><li class=active>»
<a href=https://number317.github.io/blog/shell/dockerfile_tips/>Dockerfile Tips</a></li></ul><div id=content><main id=main><h1>Dockerfile Tips</h1><time>Last updated Wed Sep 18, 2019</time><div><aside><h2>Table of Content</h1><nav id=TableOfContents></nav></aside><article id=content><h1 id=dockerfile-编写建议>Dockerfile 编写建议</h1><p>日常编写<code>Dockerfile</code>的过程中总结的一些经验:</p><ul><li><p>基础镜像尽量选择<code>alpine</code>版本，减小镜像体积，如果需要glibc，在<code>Dockerfile</code>中添加以下指令</p><div class="code-block code-block-container-indented"><pre><code id=code-b6941b1daea7f29d72b9dd1114a412b5>RUN apk --no-cache add ca-certificates wget &amp;&amp; \
    wget -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub &amp;&amp; \
    wget https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.29-r0/glibc-2.29-r0.apk &amp;&amp; \
    apk --no-cache add glibc-2.29-r0.apk</code></pre><button class=copy-code-button onclick='copyCode("code-b6941b1daea7f29d72b9dd1114a412b5",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>关于在<code>alpine</code>镜像中安装<code>glibc</code>，详情可以参考<a href=https://github.com/sgerrand/alpine-pkg-glibc target=_blank rel="noopener noreferrer">
github
</a>介绍</p></li><li><p>在<code>Dockerfile</code>里需要安装软件的尽量使用国内的源，加快ci构建，常见的操作如下：</p><ul><li>alpine:</li></ul><div class="code-block code-block-container-indented"><pre><code id=code-f2358beb7617f0ddd9dc008afa8fc634>RUN sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#39; /etc/apk/repositories</code></pre><button class=copy-code-button onclick='copyCode("code-f2358beb7617f0ddd9dc008afa8fc634",this)' title=copy>
<i class="fa fa-copy"></i></button></div><ul><li>debian:</li></ul><div class="code-block code-block-container-indented"><pre><code id=code-cd701bdb53aff8650da45b46b21835ce>curl -L &#34;https://mirrors.ustc.edu.cn/repogen/conf/debian-https-4-buster&#34; -o /etc/apt/sources.list</code></pre><button class=copy-code-button onclick='copyCode("code-cd701bdb53aff8650da45b46b21835ce",this)' title=copy>
<i class="fa fa-copy"></i></button></div><ul><li>centos:</li></ul><div class="code-block code-block-container-indented"><pre><code id=code-161fb425cfe298c0d027abe73d154afa>RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</code></pre><button class=copy-code-button onclick='copyCode("code-161fb425cfe298c0d027abe73d154afa",this)' title=copy>
<i class="fa fa-copy"></i></button></div><ul><li>node:</li></ul><div class="code-block code-block-container-indented"><pre><code id=code-c8fdd63da17030e3a61fad7b2768a8f4>RUN npm install --registry=https://registry.npm.taobao.org \
    &amp;&amp; npm config set phantomjs_cdnurl https://npm.taobao.org/dist/phantomjs \
    &amp;&amp; npm config set chromedriver_cdnurl http://cdn.npm.taobao.org/dist/chromedriver \
    &amp;&amp; npm config set sass_binary_site http://npm.taobao.org/mirrors/node-sass</code></pre><button class=copy-code-button onclick='copyCode("code-c8fdd63da17030e3a61fad7b2768a8f4",this)' title=copy>
<i class="fa fa-copy"></i></button></div></li><li><p>构建镜像时如果需要代理，可以配置以下参数：</p><div class="code-block code-block-container-indented"><pre><code id=code-fc1392acaf6b091d1d8f9f9c18130245>docker build -t imagename . --build-arg HTTP_PROXY=http://ip:port --build-arg HTTPS_PROXY=http://ip:port</code></pre><button class=copy-code-button onclick='copyCode("code-fc1392acaf6b091d1d8f9f9c18130245",this)' title=copy>
<i class="fa fa-copy"></i></button></div></li><li><p><code>apt-get</code> 命令可以通过以下参数临时设置代理:</p><div class="code-block code-block-container-indented"><pre><code id=code-09cd8f858f458867d71609937fdf24a6>RUN apt update -o Acquire::http::proxy=&#34;http://ip:port&#34; -o Acquire::https::proxy=&#34;http://ip:port&#34; &amp;&amp; \
    apt install --yes curl -o Acquire::http::proxy=&#34;http://ip:port&#34; -o Acquire::https::proxy=&#34;http://ip:port&#34;</code></pre><button class=copy-code-button onclick='copyCode("code-09cd8f858f458867d71609937fdf24a6",this)' title=copy>
<i class="fa fa-copy"></i></button></div></li><li><p>镜像设置北京时间，可以安装<code>tzdata</code>软件包，再设置<code>/etc/localtime</code>:</p><div class="code-block code-block-container-indented"><pre><code id=code-7a6a1bc1b4a4862de073e53b35e02be0>RUN apk add tzdata &amp;&amp; ln -sfv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </code></pre><button class=copy-code-button onclick='copyCode("code-7a6a1bc1b4a4862de073e53b35e02be0",this)' title=copy>
<i class="fa fa-copy"></i></button></div></li><li><p>如果容器中文显示乱码，可以在<code>Dockerfile</code>中配置<code>LANG</code>环境变量:</p><div class="code-block code-block-container-indented"><pre><code id=code-7b42bf59f6f4a5db55f4e54f94b3abd8>ENV LANG C.UTF-8</code></pre><button class=copy-code-button onclick='copyCode("code-7b42bf59f6f4a5db55f4e54f94b3abd8",this)' title=copy>
<i class="fa fa-copy"></i></button></div></li></ul></article></div></main><div><h4 id=signature>Thu Jun 13, 2019
cheon</h4><ul class=tags><li><a href=https://number317.github.io/blog/tags/docker>docker</a></li></ul><ul class=related><li><a class=previous href=https://number317.github.io/blog/shell/es_clean_indices/>Es Clean Indices</a></li></ul></div></div><section id=footer><div id=author><h2>About Author</h2><hr><img src=https://number317.github.io/images/author.jpg></img><p>Life is dance we all have to do.</p></div><ul id=link><li><a href=https://github.com/number317/aloha.git target=_blank><i class="fa fa-github" alt=github></i></a></li><li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target=_blank><i class="fa fa-envelope" alt=email></i></a></li><li id=wechat><i class="fa fa-wechat"></i></li><img class=qrcode src=https://number317.github.io/images/wechat.jpg></ul></section></body></html>