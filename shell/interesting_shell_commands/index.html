<!doctype html><html><head><meta charset=utf-8><meta name=description content="Aloha! Welcome to cheon's blog."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=76x76 href=https://number317.github.io/blog/img/apple-touch-icon.png><link rel=icon href=https://number317.github.io/blog/img/pen.svg><link rel=stylesheet href=https://number317.github.io/blog/css/global.css><link rel=stylesheet href=https://number317.github.io/blog/css/nav.css><link rel=stylesheet href=https://number317.github.io/blog/css/header.css><link rel=stylesheet href=https://number317.github.io/blog/css/index.css><link rel=stylesheet href=https://number317.github.io/blog/css/list.css><link rel=stylesheet href=https://number317.github.io/blog/css/single.css><link rel=stylesheet href=https://number317.github.io/blog/css/footer.css><link href="https://fonts.font.im/css?family=Fira+Mono|Noto+Sans|Old+Standard+TT" rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://number317.github.io/blog/js/single.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script src=https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.js async></script><title>cheon's blog</title></head><body><section id=header><ul id=menus><li class=menu><a href=https://number317.github.io><span>Home</span></a></li><li class=menu><a href=https://number317.github.io/blog/categories><span>Categories</span></a></li><li class=menu><a href=https://number317.github.io/blog/tags><span>Tags</span></a></li><li class=menu><a href=https://github.com/number317><span>Projects</span></a></li></ul><h1 id=title><a href=https://number317.github.io/blog/>cheon's blog</a></h1></section><ul id=nav><li>»
<a href=https://number317.github.io/blog/>cheon's blog</a></li><li>»
<a href=https://number317.github.io/blog/shell/>shell</a></li><li class=active>»
<a href=https://number317.github.io/blog/shell/interesting_shell_commands/>Interesting Shell Commands</a></li></ul><div id=content><main id=main><h1>Interesting Shell Commands</h1><time>Last updated Fri Apr 11, 2025</time><div><aside><h2>Table of Content</h1><nav id=TableOfContents></nav></aside><article id=content><h1 id=一些有意思的shell命令>一些有意思的shell命令</h1><div class="code-block code-block-container-indented"><pre><code id=code-ed4813578ade26b8529fbe1ad1481d8f>$ printf &#34;%x&#34; \&#39;$
$ printf \\x2F</code></pre><button class=copy-code-button onclick='copyCode("code-ed4813578ade26b8529fbe1ad1481d8f",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>将字符转化为16进制(%x), 十进制(%d)&mldr;
第二个命令将16进制转化为字符</p><div class="code-block code-block-container-indented"><pre><code id=code-d0374f15a5c82b377f6ac4ecbe83d9d1>$ python -m SimpleHTTPServer
$ python -m http.server</code></pre><button class=copy-code-button onclick='copyCode("code-d0374f15a5c82b377f6ac4ecbe83d9d1",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>使用python来建立一个简易的web service用于文件传输，第一个时python2的写法，后一个是python3的写法，默认端口为8000，可以在后面直接加端口指定端口</p><div class="code-block code-block-container-indented"><pre><code id=code-2510bbefece5271028f482c8570924bf>$ nc -l localhost -p 1016
$ nc localhost 1016
$ nc -lu localhost -p 8125
$ nc -u localhost 8125</code></pre><button class=copy-code-button onclick='copyCode("code-2510bbefece5271028f482c8570924bf",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>gnu-netcat</code>软件包，使用<code>nc</code>命令监听1016端口，然后再用<code>nc</code>可以发送数据，这可以用于文件传输，做简易的聊天工具</p><div class="code-block code-block-container-indented"><pre><code id=code-04ce4ca47815f794a791e24b9838c7f6>curl -OL https://github.com/cmderdev/cmder/releases/download/v1.3.2/cmder.zip
curl -Ss &#34;https://store.docker.com/api/content/v1/repositories/public/library/$@/tags?page_size=25&amp;page=1&#34; | jq &#39;.&#34;results&#34;[][&#34;name&#34;]&#39; | sort -r
curl -X POST -H &#34;Content-Type: application/json&#34; -H &#34;Authorization: Basic YWRtaW46YWRtaW4xMjM=&#34; &#39;http://localhost:8081/service/siesta/rest/v1/script/&#39; \
         -d &#39;{ &#34;name&#34;: &#34;updateAnonymousAccess&#34;, &#34;type&#34;: &#34;groovy&#34;, &#34;content&#34;: &#34;security.setAnonymousAccess(Boolean.valueOf(args))&#34; }&#39;</code></pre><button class=copy-code-button onclick='copyCode("code-04ce4ca47815f794a791e24b9838c7f6",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>第一行命令用于下载文件：<code>-O</code> 以原文件名字保存，<code>-L</code> 重定向跟踪，<code>-C</code> 断点续传，<code>-C -</code>自动检测断点
第二行命令用于获取docker镜像的tag：<code>-S</code> 显示错误信息，<code>-s</code> 静默模式，<code>jq</code> 命令行的json处理工具
第三行命令用于发送POST请求：<code>-H</code>指定请求头，<code>-d</code>指定请求参数，这里是json格式，也可以将数据写入文件，通过<code>-d@data.json</code> 的形式来传递数据</p><div class="code-block code-block-container-indented"><pre><code id=code-324a7a7fa67459ff345890146bde4a6a>$ cat -n file.txt
$ nl file.txt</code></pre><button class=copy-code-button onclick='copyCode("code-324a7a7fa67459ff345890146bde4a6a",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>两个命令都可以显示文本内容并在行首加上行号，<code>nl</code>默认会忽略空行，而<code>cat</code>不会</p><div class="code-block code-block-container-indented"><pre><code id=code-c5307d9e8cbe1b090ed6fc6bb4756b72>curl -u admin:admin &#34;http://grafana.test.com/api/admin/settings&#34; 2&gt;/dev/null | json_reformat
curl -u admin:admin &#34;http://grafana.test.com/api/admin/settings&#34; 2&gt;/dev/null | python -m json.tool
curl -u admin:admin &#34;http://grafana.test.com/api/admin/settings&#34; 2&gt;/dev/null | jq.[]</code></pre><button class=copy-code-button onclick='copyCode("code-c5307d9e8cbe1b090ed6fc6bb4756b72",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>yajl</code>软件包，<code>json_reformat</code>命令可以将标准输出的json内容格式化，以便于阅读
python的json.tool模块也可用于json格式化
<code>jq</code>有更加强大的功能，不仅可以格式化json，还可以从json中取出相应字段。</p><div class="code-block code-block-container-indented"><pre><code id=code-9392a16ef7f8fdb2676eccfd64e4af2f>$ du -sh *</code></pre><button class=copy-code-button onclick='copyCode("code-9392a16ef7f8fdb2676eccfd64e4af2f",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>可以显示当前一级目录下所有目录（或文件）的大小，<code>-h</code>以人类可读的单位显示，<code>-s</code>只显示当前目录下的文件，不递归显示，<code>*</code>代表当前目录下所有文件</p><p>shell 脚本中<code>''</code>和<code>""</code>效果不同，<code>''</code>中的字符串被当作一般字符串处理，即使有<code>$varaible</code>的字符串也不会被解析，而<code>""</code>中的变量会被解析。</p><p>shell 脚本中``和<code>$()</code>用于命令替换，<code>${}</code>用于变量替换，变量替换功能非常强大，有类似切片的功能</p><div class="code-block code-block-container-indented"><pre><code id=code-6eccb0190ca77d9876942a8f21dba771>sed -i -e &#34;s/profiler.collector.ip=172.20.0.219/profiler.collector.ip=localhost/&#34; -e &#34;/profiler.collector.ip=/a profiler.jvm.vendor.name=Oracle&#34; -e &#34;s/profiler.sampling.rate=20/profiler.sampling.rate=1/&#34; pinpoint.config
sed -i 1d pinpoint.config
sed -i &#34;1d;3d&#34; test.txt
sed -i &#34;1,3d&#34; test.txt</code></pre><button class=copy-code-button onclick='copyCode("code-6eccb0190ca77d9876942a8f21dba771",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>-i</code> 直接修改文件
<code>-e</code> 指定多个匹配项
<code>s/pattern/changer/</code> 修改匹配
<code>/pattern/a \line1\nline2</code> 在匹配项后添加行，<code>\n</code> 分行
<code>/pattern/i \line</code> 在匹配项前添加行
<code>1d;3d</code> 删除第一行和第三行
<code>1,3d</code> 删除第一到三行</p><div class="code-block code-block-container-indented"><pre><code id=code-c06fab61ac6662194484a135c0128571>xrandr -s 1366x768</code></pre><button class=copy-code-button onclick='copyCode("code-c06fab61ac6662194484a135c0128571",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>xrandr</code> 用于强制修改分辨率，可以用 <code>xrandr</code> 命令列出可用的分辨率</p><div class="code-block code-block-container-indented"><pre><code id=code-30e2ce2851d9fd69fed75a3cf0a122d4>$ nohup command &gt; run.log 2&gt;&amp;1 &amp;
$ nohup command &amp;&gt; run.log &amp;</code></pre><button class=copy-code-button onclick='copyCode("code-30e2ce2851d9fd69fed75a3cf0a122d4",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>nohup ... &</code>可以将程序后台运行，<code>&></code>可以将标准输出和错误输出都重定向到文件中，<code>2>&amp;1</code> 表示将错误输出重定向到标准输出。</p><div class="code-block code-block-container-indented"><pre><code id=code-0470b805841bfac0bcaa515c228335fb>$ telnet towel.blinkenlights.nl</code></pre><button class=copy-code-button onclick='copyCode("code-0470b805841bfac0bcaa515c228335fb",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>在终端里看《星球大战》</p><div class="code-block code-block-container-indented"><pre><code id=code-412bdde35861addb463f4c610373bb95>curl wttr.in/shanghai</code></pre><button class=copy-code-button onclick='copyCode("code-412bdde35861addb463f4c610373bb95",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>终端下的天气预报</p><div class="code-block code-block-container-indented"><pre><code id=code-3fe80bf331d152648d91d1d2fa3b3309>for code in {0..255};do
    echo -en &#34;\e[38;05;${code}m██&#34;
done</code></pre><button class=copy-code-button onclick='copyCode("code-3fe80bf331d152648d91d1d2fa3b3309",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>在终端中输出 256 色的色块</p><div class="code-block code-block-container-indented"><pre><code id=code-bb76aba33bc448f5fec7dc049ec8a913>$ A=1;echo $A;{ A=2; };echo $A
1
2
$ A=1;echo $A;( A=2; );echo $A
1
1 </code></pre><button class=copy-code-button onclick='copyCode("code-bb76aba33bc448f5fec7dc049ec8a913",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>{}</code>中的命令会在当前进程中执行，<code>()</code>中的命令会在子进程中执行</p><div class="code-block code-block-container-indented"><pre><code id=code-04c8b3b37e19c08ec5ae2913c1cc9ddc>seq 100</code></pre><button class=copy-code-button onclick='copyCode("code-04c8b3b37e19c08ec5ae2913c1cc9ddc",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>用于生成一个 1~100 的序列</p><div class="code-block code-block-container-indented"><pre><code id=code-8871f28b0db53822f06ddd3823019c24>ansible -i hosts all -m shell -a &#34;free | sed &#39;1d;3d&#39; | awk &#39;{print \$3/\$2}&#39;&#34; | grep -v SUCCESS | awk &#39;{sum &#43;= $1;} END {print $sum/NR}&#39;</code></pre><button class=copy-code-button onclick='copyCode("code-8871f28b0db53822f06ddd3823019c24",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>该命令可以用于计算集群机器的平均空闲内存的百分比，用到了 <code>sed</code>，<code>awk</code>，<code>grep</code> 等 linux 常用的文本处理工具。需要注意的是在 ansible 里使用 awk 时，变量需要用<code>\</code>转义<code>$</code></p><div class="code-block code-block-container-indented"><pre><code id=code-9545c2aba83b1a729804eafc0c8ab601>ansible -i inventory/hosts all -m copy -a &#34;src=https://number317.github.io/blog/etc/yum.repos.d/Centos-7.repo backup=yes dest=/etc/yum.repos.d&#34;</code></pre><button class=copy-code-button onclick='copyCode("code-9545c2aba83b1a729804eafc0c8ab601",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>ansible copy 模块可用于将本机文件分发到其他节点</p><div class="code-block code-block-container-indented"><pre><code id=code-295f2ddd17085aead5d6d73aa797d2cc>usage(){
	cat &lt;&lt;-EOF
		usage
		EOF
}
usage</code></pre><button class=copy-code-button onclick='copyCode("code-295f2ddd17085aead5d6d73aa797d2cc",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>bash 的 here document 可以用 tab 来缩进，注意必须是 tab，不能是空格。</p><div class="code-block code-block-container-indented"><pre><code id=code-1d3824e21ac896fb699473db41b6cc29>exec $SHELL -l</code></pre><button class=copy-code-button onclick='copyCode("code-1d3824e21ac896fb699473db41b6cc29",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>重载shell而无需退出</p><div class="code-block code-block-container-indented"><pre><code id=code-41ba08ad16fbd2c1f1164bb8ee865409>disown -a &amp;&amp; exit</code></pre><button class=copy-code-button onclick='copyCode("code-41ba08ad16fbd2c1f1164bb8ee865409",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>退出 shell 并保持子进程运行</p><div class="code-block code-block-container-indented"><pre><code id=code-9c436a06936af13b46749c7703196d04>history | \
awk &#39;{CMD[$2]&#43;&#43;;count&#43;&#43;;}END { for (a in CMD)print CMD[a] &#34; &#34; CMD[a]/count*100 &#34;% &#34; a;}&#39; | \
grep -v &#34;./&#34; | \
column -c3 -s &#34; &#34; -t | \
sort -nr | nl |  head -n 20</code></pre><button class=copy-code-button onclick='copyCode("code-9c436a06936af13b46749c7703196d04",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>列出最常使用的命令</p><div class="code-block code-block-container-indented"><pre><code id=code-41505bc2a272f839ae49660960d7446f>cp filename{,.orig}</code></pre><button class=copy-code-button onclick='copyCode("code-41505bc2a272f839ae49660960d7446f",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>快速拷贝一份文件</p><div class="code-block code-block-container-indented"><pre><code id=code-b54f59835c209f93e069396710f70519>&gt;filename</code></pre><button class=copy-code-button onclick='copyCode("code-b54f59835c209f93e069396710f70519",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>清空一个文件</p><div class="code-block code-block-container-indented"><pre><code id=code-639f29ce3f1e067fe4e0c7eeffa64336>rm !(*.foo|*.bar|*.baz)</code></pre><button class=copy-code-button onclick='copyCode("code-639f29ce3f1e067fe4e0c7eeffa64336",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>删除不匹配的文件</p><div class="code-block code-block-container-indented"><pre><code id=code-a02906433b20b58c59067e69209c3300>rename foo bar foo*.txt </code></pre><button class=copy-code-button onclick='copyCode("code-a02906433b20b58c59067e69209c3300",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p><code>rename</code> 命令用于批量重命名文件，上述命令将 foo 替换为 bar，如 foo1.txt → bar1.txt，使用 <code>-nv</code> 参数可以 dry-run</p><div class="code-block code-block-container-indented"><pre><code id=code-9c792bcd3126ab58f85e330267ff976d>printf &#34;%`tput cols`s&#34; | tr &#39; &#39; &#39;#&#39;</code></pre><button class=copy-code-button onclick='copyCode("code-9c792bcd3126ab58f85e330267ff976d",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>输出一整行的 <code>#</code></p><div class="code-block code-block-container-indented"><pre><code id=code-5c290a3641197ce2443dc0e0ac14ac6f>timeout 1 bash -c &#34;echo &gt; /dev/tcp/$ip/$port&#34;
[[ $? -eq 0 ]] || echo $ip $protocol $port</code></pre><button class=copy-code-button onclick='copyCode("code-5c290a3641197ce2443dc0e0ac14ac6f",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>用于检测端口是否畅通，不通则输出 ip、协议、端口。udp 同理</p><div class="code-block code-block-container-indented"><pre><code id=code-89c8bcbf757a84bb8ef750bcb954a1eb>mysqldump --set-gtid-purged=off --default-character-set=utf8 -u${mysql_user} -p&#34;${mysql_password}&#34; -h${mysql_host} --databases ${mysql_database} &gt; ./backup-$(date &#43;%Y%m%d).sql
mysql -u${mysql_user} -p&#34;${mysql_password}&#34; -h${mysql_host} ${mysql_database} &lt; ./backup-$(date &#43;%Y%m%d).sql</code></pre><button class=copy-code-button onclick='copyCode("code-89c8bcbf757a84bb8ef750bcb954a1eb",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>上述命令用于备份/恢复 mysql 数据库</p><div class="code-block code-block-container-indented"><pre><code id=code-2e67a6c5d77b1929bb7ff68a4af7973e>screen -S sessionName
screen -A -x sessionName</code></pre><button class=copy-code-button onclick='copyCode("code-2e67a6c5d77b1929bb7ff68a4af7973e",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>上述命令可以在多个终端间共享会话。<code>-A</code> 设置窗口大小为当前终端。</p><div class="code-block code-block-container-indented"><pre><code id=code-e5df9a3728de426bd2ff3ce8a57756cc>ssh -fNg -D 8081 appuser@192.168.0.101 -p 22</code></pre><button class=copy-code-button onclick='copyCode("code-e5df9a3728de426bd2ff3ce8a57756cc",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>上述命令将创建 ssh 隧道，本地监听 8081 端口，配合浏览器插件 Proxy Switch Omega 即可实现翻墙。这个需要服务器的 ssh 开启 <code>GatewayPorts yes</code> 的配置。</p><div class="code-block code-block-container-indented"><pre><code id=code-13155a996f1deb17d7858c68cbd2b78d>jp2a test.png</code></pre><button class=copy-code-button onclick='copyCode("code-13155a996f1deb17d7858c68cbd2b78d",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>将图片转换为 ascii 字符画，archlinux 上需要按照 jp2a 包</p><div class="code-block code-block-container-indented"><pre><code id=code-bb74a28c4a371c603538b6aff7bb9902>convert color.png -colorspace Gray gray.png
convert gray.png -monochrome two.png</code></pre><button class=copy-code-button onclick='copyCode("code-bb74a28c4a371c603538b6aff7bb9902",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>第一个命令将图片转化为灰度
第二个命令将图片二值化</p><div class="code-block code-block-container-indented"><pre><code id=code-d2526e1946ff6c670361b8360796601a>echo &#34;hello world&#34; | curl -F &#39;f:1=&lt;-&#39; ix.io</code></pre><button class=copy-code-button onclick='copyCode("code-d2526e1946ff6c670361b8360796601a",this)' title=copy>
<i class="fa fa-copy"></i></button></div><p>在线剪切板，会返回一个链接</p></article></div></main><div><h4 id=signature>Wed Apr 25, 2018
cheon</h4><ul class=tags><li><a href=https://number317.github.io/blog/tags/bash>bash</a></li></ul><ul class=related><li><a class=previous href=https://number317.github.io/blog/shell/bash_expansion/>Bash Expansion</a></li><li><a class=next href=https://number317.github.io/blog/shell/es_clean_indices/>Es Clean Indices</a></li></ul></div></div><section id=footer><div id=author><h2>About Author</h2><hr><img src=https://number317.github.io/images/author.jpg></img><p>Life is dance we all have to do.</p></div><ul id=link><li><a href=https://github.com/number317/aloha.git target=_blank><i class="fa fa-github" alt=github></i></a></li><li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target=_blank><i class="fa fa-envelope" alt=email></i></a></li><li id=wechat><i class="fa fa-wechat"></i></li><img class=qrcode src=https://number317.github.io/images/wechat.jpg></ul></section></body></html>